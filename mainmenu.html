<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="css/minimal.css">
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/beamng.css">
    <script src="js/jquery.js"></script>
    <script src="js/jquery.menu.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/minimal.js"></script>
</head>
<body>
    <svg display="none" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1832" height="32" viewBox="0 0 1832 32">
        <defs>
            <g id="icon-bubbles2">
                <path class="path1" d="M15 4c-1.583 0-3.112 0.248-4.543 0.738-1.341 0.459-2.535 1.107-3.547 1.926-1.876 1.518-2.91 3.463-2.91 5.474 0 1.125 0.315 2.217 0.935 3.247 0.646 1.073 1.622 2.056 2.821 2.842 0.951 0.624 1.592 1.623 1.761 2.748 0.028 0.187 0.051 0.375 0.068 0.564 0.085-0.079 0.169-0.16 0.254-0.244 0.754-0.751 1.771-1.166 2.823-1.166 0.167 0 0.335 0.011 0.503 0.032 0.605 0.077 1.223 0.116 1.836 0.116 1.583 0 3.112-0.248 4.543-0.738 1.341-0.459 2.535-1.107 3.547-1.926 1.876-1.518 2.91-3.463 2.91-5.474 0-2.012-1.033-3.956-2.91-5.474-1.012-0.819-2.206-1.467-3.547-1.926-1.431-0.49-2.96-0.738-4.543-0.738zM15 0v0c8.284 0 15 5.435 15 12.139s-6.716 12.139-15 12.139c-0.796 0-1.576-0.051-2.339-0.147-3.222 3.209-6.943 3.785-10.661 3.869v-0.785c2.008-0.98 3.625-2.765 3.625-4.804 0-0.285-0.022-0.564-0.063-0.837-3.392-2.225-5.562-5.625-5.562-9.434 0-6.704 6.716-12.139 15-12.139zM31.125 27.209c0 1.748 1.135 3.278 2.875 4.118v0.673c-3.223-0.072-6.181-0.566-8.973-3.316-0.661 0.083-1.337 0.126-2.027 0.126-2.983 0-5.732-0.805-7.925-2.157 4.521-0.016 8.789-1.464 12.026-4.084 1.631-1.32 2.919-2.87 3.825-4.605 0.961-1.84 1.449-3.799 1.449-5.825 0-0.326-0.014-0.651-0.039-0.974 2.268 1.873 3.664 4.426 3.664 7.24 0 3.265-1.88 6.179-4.82 8.086-0.036 0.234-0.055 0.474-0.055 0.718z"></path>
            </g>
            <g id="icon-users">
                <path class="path1" d="M30.5 32h-21c-0.828 0-1.5-0.672-1.5-1.5 0-2.152 0.908-4.756 2.43-6.967 1.272-1.847 2.834-3.238 4.521-4.050-0.744-0.676-1.384-1.501-1.891-2.441-0.813-1.508-1.242-3.252-1.242-5.041 0-2.488 0.819-4.838 2.306-6.618 1.552-1.858 3.639-2.881 5.876-2.881s4.324 1.023 5.876 2.882c1.487 1.78 2.306 4.131 2.306 6.618 0 1.79-0.43 3.533-1.242 5.041-0.507 0.941-1.147 1.765-1.891 2.441 1.687 0.812 3.25 2.203 4.521 4.050 1.521 2.21 2.43 4.815 2.43 6.967 0 0.828-0.672 1.5-1.5 1.5zM11.19 29h17.62c-0.288-1.229-0.891-2.575-1.711-3.766-1.295-1.882-2.912-3.113-4.551-3.466-0.691-0.149-1.184-0.76-1.184-1.466v-1.072c0-0.539 0.29-1.037 0.758-1.304 1.859-1.057 3.060-3.383 3.060-5.926 0-3.584-2.325-6.5-5.182-6.5s-5.182 2.916-5.182 6.5c0 2.543 1.201 4.869 3.060 5.926 0.469 0.267 0.758 0.764 0.758 1.304v1.072c0 0.707-0.493 1.317-1.184 1.466-1.639 0.353-3.256 1.584-4.551 3.466-0.82 1.191-1.423 2.537-1.711 3.766zM6.16 27h-2.97c0.288-1.229 0.891-2.575 1.711-3.766 1.296-1.882 2.912-3.113 4.551-3.466 0.691-0.149 1.184-0.76 1.184-1.466v-1.072c0-0.539-0.29-1.037-0.758-1.304-1.859-1.057-3.060-3.383-3.060-5.926 0-3.584 2.325-6.5 5.182-6.5 0.195 0 0.388 0.014 0.578 0.041 0.824-0.917 1.757-1.662 2.77-2.219-1.037-0.538-2.172-0.822-3.348-0.822-2.237 0-4.324 1.023-5.876 2.882-1.487 1.78-2.306 4.131-2.306 6.618 0 1.79 0.429 3.533 1.242 5.041 0.507 0.941 1.147 1.765 1.891 2.441-1.687 0.812-3.25 2.203-4.521 4.050-1.522 2.21-2.43 4.815-2.43 6.967 0 0.828 0.672 1.5 1.5 1.5h4.137c0.046-0.97 0.225-1.982 0.523-3z"></path>
            </g>
            <g id="icon-settings">
                <path class="path1" d="M14 4v-0.5c0-0.825-0.675-1.5-1.5-1.5h-5c-0.825 0-1.5 0.675-1.5 1.5v0.5h-6v4h6v0.5c0 0.825 0.675 1.5 1.5 1.5h5c0.825 0 1.5-0.675 1.5-1.5v-0.5h18v-4h-18zM8 8v-4h4v4h-4zM26 13.5c0-0.825-0.675-1.5-1.5-1.5h-5c-0.825 0-1.5 0.675-1.5 1.5v0.5h-18v4h18v0.5c0 0.825 0.675 1.5 1.5 1.5h5c0.825 0 1.5-0.675 1.5-1.5v-0.5h6v-4h-6v-0.5zM20 18v-4h4v4h-4zM14 23.5c0-0.825-0.675-1.5-1.5-1.5h-5c-0.825 0-1.5 0.675-1.5 1.5v0.5h-6v4h6v0.5c0 0.825 0.675 1.5 1.5 1.5h5c0.825 0 1.5-0.675 1.5-1.5v-0.5h18v-4h-18v-0.5zM8 28v-4h4v4h-4z"></path>
            </g>
            <g id="icon-exit">
                <path class="path1" d="M24 20v-4h-10v-4h10v-4l6 6zM22 18v8h-10v6l-12-6v-26h22v10h-2v-8h-16l8 4v18h8v-6z"></path>
            </g>
            <g id="icon-play2">
                <path class="path1" d="M16 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zM16 29c-7.18 0-13-5.82-13-13s5.82-13 13-13 13 5.82 13 13-5.82 13-13 13zM12 9l12 7-12 7z"></path>
            </g>
        </defs>
    </svg>
    <div id="menu">
        <div class="arrow"><</div>
        <nav>
            <a href="#" onclick="beamng.sendGameEngine('MainMenuGui.onBtnPlay();')"><svg class="icon icon-play2" viewBox="0 0 32 32"><use xlink:href="#icon-play2"></use></svg>&nbsp;&nbsp;Play</a>
            <a href="#" onclick="beamng.sendGameEngine('Canvas.pushDialog(optionsDlg); Canvas.pushDialog(PostFXManager);')"><svg class="icon icon-settings" viewBox="0 0 32 32"><use xlink:href="#icon-settings"></use></svg>&nbsp;&nbsp;Options</a>
            <a href="#" onclick="window.location.href='file:///html/credits.html'; beamng.sendGameEngine('MainMenuGui.creditsToggle();')"><svg class="icon icon-users" viewBox="0 0 32 32"><use xlink:href="#icon-users"></use></svg>&nbsp;&nbsp;The team</a>
            <a href="#" onclick="window.location.href='file:///html/chat.html';"><svg class="icon icon-bubbles2" viewBox="0 0 32 32"><use xlink:href="#icon-bubbles2"></use></svg>&nbsp;&nbsp;Chat</a>
            <a href="#" onclick="beamng.sendGameEngine('quit();')"><svg class="icon icon-exit" viewBox="0 0 32 32"><use xlink:href="#icon-exit"></use></svg>&nbsp;&nbsp;Exit</a>
            <a href="#" onclick="window.location.href='file:///html/controller.html';"><svg class="icon icon-wrench" viewBox="0 0 32 32"><use xlink:href="#icon-wrench"></use></svg>&nbsp;&nbsp;Input Test</a>
            
        </nav>
        <div class="steaminfo" id="steaminfo"></div>
        <div class="version" id="beamngversion"></div>
    </div>

    <div id="video-viewport">
        <video preload width="1920" height="1080" id="bgvid"></video>
    </div>
    <div id='infobox'></div>

    <div id='blending'></div>


    <style type="text/css">
        body {
            overflow: hidden;
            margin: 0;
            padding: 0;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        #video-viewport {
            position: absolute;
            top: 0;
            overflow: hidden;
            z-index: -2; /* for accessing the video by click */
        }

        #blending {
            position: absolute;
            background: black;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: -1;
        }

        #infobox {
            position: absolute;
            bottom: 0px;
            left: 0px;
            z-index: -1;
            padding: 5px;
            margin: 5px;
            background-color: rgba(255,255,255,0.6);
            box-shadow: 0px 0px 20px rgba(255,255,255,0.6);
            border-radius: 6px;
            font-size: 0.8em;
            font-family: verdana;
        }
    </style>

    <script type="text/javascript">
        var videoConfig = [
            // video, title, description, mission name to load, position/rotation
            ["images/mainmenu_1.webm", "Small Island", "High speed asphalt and some technical dirt roads", "small_island.mis", "111.252 -375.783 30.0412 0 0 81.476"],
            ["images/mainmenu_2.webm", "Small Island", "High speed asphalt and some technical dirt roads", "small_island.mis", "111.252 -375.783 30.0412 0 0 81.476"],
            ["images/mainmenu_3.webm", "Small Island", "High speed asphalt and some technical dirt roads", "small_island.mis", "-354.373 170.426 39.4306 0 0 1 208.446"],
            ["images/mainmenu_4.webm", "Small Island", "High speed asphalt and some technical dirt roads", "small_island.mis", "111.252 -375.783 30.0412 -0.0613498 -0.0460925 0.997052 106.327"],
            ["images/mainmenu_5.webm", "Small Island", "High speed asphalt and some technical dirt roads", "small_island.mis", "-242.088 87.4816 39.6549 -0.00772832 -0.036043 0.99932 189.094"],
            ["images/mainmenu_6.webm", "Small Island", "High speed asphalt and some technical dirt roads", "small_island.mis", "16.6853 -395.176 31.446 0 0 1 73.887"],
            ["images/mainmenu_7.webm", "Small Island", "High speed asphalt and some technical dirt roads", "small_island.mis", "-172.176 235.843 48.1855 0 0 1 87.774"],
            ["images/mainmenu_8.webm", "Dry Rock Island", "A long abandoned industrial island", "dry_rock_island.mis", "-450.022 -106.288 63.4009 0 0 -1 4.68703"],
            ["images/mainmenu_9.webm", "Dry Rock Island", "A long abandoned industrial island", "dry_rock_island.mis", "-703.965 309.649 41.908 0 0 1 152.314"],
            ["images/mainmenu_10.webm", "Industrial", "Port, rallycross, circuit, offroad track", "dry_rock_island.mis", "216.223 116.715 42.6993 -0.0362537 0.0379904 -0.99862 87.399"],
        ];

        var min_w = 300; // minimum video width allowed
        var vid_w_orig;  // original video dimensions
        var vid_h_orig;

        var videoElement = null;

        var fadeTime = 2; // in seconds

        var randomArray = randomNumbers(videoConfig.length);

        var randomPosition = -1;
        var currentEntryID = -1;
        var currentEntry = null;

        function resizeToCover() {
            // set the video viewport to the window size
            $('#video-viewport').width($(window).width());
            $('#video-viewport').height($(window).height());

            // use largest scale factor of horizontal/vertical
            var scale_h = $(window).width() / vid_w_orig;
            var scale_v = $(window).height() / vid_h_orig;
            var scale = scale_h > scale_v ? scale_h : scale_v;

            // don't allow scaled width < minimum video width
            if (scale * vid_w_orig < min_w) { scale = min_w / vid_w_orig; }

            // now scale the video
            $('video').width(scale * vid_w_orig);
            $('video').height(scale * vid_h_orig);
            // and center it by scrolling the video viewport
            $('#video-viewport').scrollLeft(($('video').width() - $(window).width()) / 2);
            $('#video-viewport').scrollTop(($('video').height() - $(window).height()) / 2);
        }

        $(document).ready(function () {
            videoElement = document.getElementById('bgvid');

            playNewEntry();
            $('#blending').fadeOut(fadeTime * 1000);

            $('#bgvid').bind('ended', function (event) {
                playNewEntry();
                $('#blending').fadeOut(fadeTime * 1000);
            });

            // fixes video size
            vid_w_orig = parseInt($('video').attr('width'));
            vid_h_orig = parseInt($('video').attr('height'));
            $(window).resize(function () { resizeToCover(); });
            $(window).trigger('resize');

            // run blending
            checkTime();
        });

        function checkTime() {
            if (videoElement.duration - videoElement.currentTime < fadeTime + 0.1) {
                $('#blending').fadeIn(fadeTime * 1000);
                setTimeout(checkTime, 4000);
            } else {
                setTimeout(checkTime, videoElement.duration - videoElement.currentTime - (fadeTime + 0.05) * 1000);
            }
        }

        function playNewEntry() {
            if (videoConfig.length < 1) return;

            randomPosition++;
            if (randomPosition == videoConfig.length) {
                randomPosition = 0;
                while (randomArray[0] == currentEntryID) {
                    randomArray = randomNumbers(videoConfig.length);
                }
            }
            currentEntryID = randomArray[randomPosition];
            currentEntry = videoConfig[currentEntryID];

            // play the video
            $('#bgvid').attr("src", currentEntry[0]);
            videoElement.play();

            // update the info text
            $('#infobox').html(currentEntry[1] + '<br/>' + currentEntry[2]);
        }
        
        function gotGameVersion(versionStr) {
            $('#beamngversion').html(versionStr);
        }
        function gotSteamData(data) {
            //console.log("steam data:");
            //console.log(data);
            if(data.working && data.loggedin) {
                var t = '<b>' + data.playerName + '</b><br/>';
                if(data.branch != 'public')
                    t += data.branch + '<br/>';
                if(data.language != 'english')
                    t += data.language + '<br/>';
                $('#steaminfo').html(t);
            }
        }
        beamng.requestVersionInfo();
        beamng.requestSteamInfo();
    </script>
    <button class='cefdev' onclick="javascript:location.reload();" style="width: 60px; height: 20px;
        position: absolute; left: 0px; top: 0px; margin: 0; padding: 0;">
        ReloadUI
    </button>
</body>
</html>
