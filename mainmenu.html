<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="css/minimal.css">
    <script src="js/jquery.js"></script>
    <script src="js/utils.js"></script>
</head>
<body>
<div style="position:fixed; right:0; top: 0; bottom:0; padding:0px; text-align:right; display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-pack: center; -webkit-box-align: end;">
<div style="width: 300px">
<a class="rbutton" href="browser.html" >Browser</a><br/>
<a class="rbutton" href="#" onclick="" >Repository</a><br/>
<a class="rbutton" href="#" onclick="beamng.sendGameEngine('MainMenuGui.onBtnPlay();')" >Play</a><br/>
<a class="rbutton" href="#" onclick="beamng.sendGameEngine('Canvas.pushDialog(optionsDlg); Canvas.pushDialog(PostFXManager);')" >Options</a><br/>
<a class="rbutton" href="options.html" >HTML Options</a><br/>
<a class="rbutton" href="#" onclick="window.location.href='file:///html/credits.html'; beamng.sendGameEngine('MainMenuGui.creditsToggle();')" >The team</a><br/>
<a class="rbutton" href="chat.html">Chat</a><br/>
<a class="rbutton" href="#" onclick="beamng.sendGameEngine('quit();')" >Exit</a><br/>
</div>
</div>

<div id="video-viewport">
    <video preload width="1920" height="1080" id="bgvid">
    </video>
</div>
<div id='infobox'></div>

<div id='blending'></div>


<style type="text/css">
body {
    overflow:hidden;
    margin:0;
    padding:0;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
}
#video-viewport {
    position: absolute;
    top: 0;
    overflow: hidden;
    z-index: -2; /* for accessing the video by click */
}
#blending {
    position: absolute;
    background: black;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: -1;
}

#infobox {
	position: absolute;
    bottom: 0px;
    left: 0px;
    z-index: -1;
    padding: 5px;
    margin:5px;
    background-color: rgba(255,255,255,0.6);
    box-shadow: 0px 0px 20px rgba(255,255,255,0.6);
	border-radius: 6px;
	font-size:0.8em;
	font-family:verdana;
}
</style>

<script type="text/javascript">
var videoConfig = [
	// video, title, description, mission name to load, position/rotation
	["images/mainmenu_1.webm",  "Small Island", "High speed asphalt and some technical dirt roads", "dry_rock_island.mis", ""],
	["images/mainmenu_2.webm",  "Small Island", "High speed asphalt and some technical dirt roads", "dry_rock_island.mis", ""],
	["images/mainmenu_3.webm",  "Small Island", "High speed asphalt and some technical dirt roads", "dry_rock_island.mis", ""],
	["images/mainmenu_4.webm",  "Small Island", "High speed asphalt and some technical dirt roads", "dry_rock_island.mis", ""],
	["images/mainmenu_5.webm",  "Small Island", "High speed asphalt and some technical dirt roads", "dry_rock_island.mis", ""],
	["images/mainmenu_6.webm",  "Small Island", "High speed asphalt and some technical dirt roads", "dry_rock_island.mis", ""],
	["images/mainmenu_7.webm",  "Small Island", "High speed asphalt and some technical dirt roads", "dry_rock_island.mis", ""],
	["images/mainmenu_8.webm",  "Dry Rock Island", "A long abandoned industrial island", "dry_rock_island.mis", ""],
	["images/mainmenu_9.webm",  "Dry Rock Island", "A long abandoned industrial island", "dry_rock_island.mis", ""],
	["images/mainmenu_10.webm", "Industrial", "Port, rallycross, circuit, offroad track", "dry_rock_island.mis", ""],
];

var min_w = 300; // minimum video width allowed
var vid_w_orig;  // original video dimensions
var vid_h_orig;

var videoElement = null;

var fadeTime = 2; // in seconds

var randomArray = randomNumbers(videoConfig.length);

var randomPosition = -1;
var currentEntryID = -1;
var currentEntry = null;

function resizeToCover() {
    // set the video viewport to the window size
    $('#video-viewport').width($(window).width());
    $('#video-viewport').height($(window).height());

    // use largest scale factor of horizontal/vertical
    var scale_h = $(window).width() / vid_w_orig;
    var scale_v = $(window).height() / vid_h_orig;
    var scale = scale_h > scale_v ? scale_h : scale_v;

    // don't allow scaled width < minimum video width
    if (scale * vid_w_orig < min_w) {scale = min_w / vid_w_orig;}

    // now scale the video
    $('video').width(scale * vid_w_orig);
    $('video').height(scale * vid_h_orig);
    // and center it by scrolling the video viewport
    $('#video-viewport').scrollLeft(($('video').width() - $(window).width()) / 2);
    $('#video-viewport').scrollTop(($('video').height() - $(window).height()) / 2);
}

$(document).ready(function() {
    videoElement = document.getElementById('bgvid');

	playNewEntry();
    $('#blending').fadeOut(fadeTime * 1000);

    $('#bgvid').bind('ended', function(event) {
    	playNewEntry();
        $('#blending').fadeOut(fadeTime * 1000);
    });

    // fixes video size
    vid_w_orig = parseInt($('video').attr('width'));
    vid_h_orig = parseInt($('video').attr('height'));
    $(window).resize(function () { resizeToCover(); });
    $(window).trigger('resize');

    // run blending
    checkTime();
});

function checkTime() {
    if(videoElement.duration - videoElement.currentTime < fadeTime + 0.1) {
        $('#blending').fadeIn(fadeTime * 1000);
        setTimeout(checkTime, 4000);
    } else {
        setTimeout(checkTime, videoElement.duration - videoElement.currentTime - (fadeTime+ 0.05) * 1000);
    }
}

function playNewEntry() {
    if (videoConfig.length < 1)  return;

    randomPosition++;
    if(randomPosition == videoConfig.length) {
        randomPosition = 0;
        while(randomArray[0] == currentEntryID) {
            randomArray = randomNumbers(videoConfig.length);
        }
    }
    currentEntryID = randomArray[randomPosition];
    currentEntry = videoConfig[currentEntryID];

    // play the video
    $('#bgvid').attr("src", currentEntry[0]);
    videoElement.play();

    // update the info text
    $('#infobox').html(currentEntry[1] + '<br/>' + currentEntry[2]);
}
</script>


<button onclick="javascript:location.reload();" style="width:60px;height:20px;position:absolute;right:0px;bottom:0px;margin:0;padding:0;">ReloadUI</button>
</body>
</html>